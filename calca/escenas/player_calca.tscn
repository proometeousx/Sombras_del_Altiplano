[gd_scene load_steps=77 format=3 uid="uid://cra2fcp1dddgm"]

[ext_resource type="Texture2D" uid="uid://b0720wro4rfcg" path="res://calca/calca-sprintsheet.png" id="1_tu7p3"]

[sub_resource type="GDScript" id="GDScript_2bxub"]
script/source = "extends CharacterBody2D

const WALK_SPEED := 140.0
const RUN_SPEED  := 260.0
const JUMP_VELOCITY := -400.0
const JUMP_LARGE_VELOCITY := -520.0
const DOUBLE_JUMP_TIME := 0.3  # ventana para doble salto

@onready var anim: AnimatedSprite2D = $AnimatedSprite2D

var last_jump_time: float = -1.0

func _physics_process(delta: float) -> void:
	# gravedad
	if not is_on_floor():
		velocity += get_gravity() * delta

	# ====== INPUTS (todas teclas distintas) ======
	var move_left  := Input.is_action_pressed(\"move_left\")   # A
	var move_right := Input.is_action_pressed(\"move_right\")  # D
	var run_pressed := Input.is_action_pressed(\"run_key\")    # Shift
	var crouch_pressed := Input.is_action_pressed(\"crouch_key\") and is_on_floor()  # S
	var jump_pressed := Input.is_action_just_pressed(\"jump_key\")   # W
	var punch_pressed := Input.is_action_just_pressed(\"punch_key\") # J

	# direcci√≥n horizontal (-1, 0, 1)
	var dir := 0.0
	if move_left:
		dir -= 1.0
	if move_right:
		dir += 1.0

	# ====== MOVIMIENTO HORIZONTAL ======
	if crouch_pressed:
		velocity.x = move_toward(velocity.x, 0, RUN_SPEED)
	else:
		if dir != 0:
			var speed := RUN_SPEED if run_pressed else WALK_SPEED
			velocity.x = dir * speed
			anim.flip_h = dir < 0
		else:
			velocity.x = move_toward(velocity.x, 0, RUN_SPEED)

	# ====== SALTO / DOBLE SALTO ======
	if jump_pressed and is_on_floor() and not crouch_pressed:
		var now := Time.get_ticks_msec() / 1000.0
		if last_jump_time > 0.0 and (now - last_jump_time) <= DOUBLE_JUMP_TIME:
			velocity.y = JUMP_LARGE_VELOCITY
			anim.play(\"jump_large\")
		else:
			velocity.y = JUMP_VELOCITY
			anim.play(\"jump\")
		last_jump_time = now

	# ====== ANIMACIONES ======
	if punch_pressed and is_on_floor() and not crouch_pressed:
		anim.play(\"punch\")
	elif crouch_pressed:
		anim.play(\"crouch\")
	elif not is_on_floor():
		if anim.animation != \"jump_large\":
			anim.play(\"jump\")
	else:
		if dir == 0:
			anim.play(\"idle\")
		else:
			if run_pressed:
				anim.play(\"run\")
			else:
				anim.play(\"walk\")

	move_and_slide()
"

[sub_resource type="CapsuleShape2D" id="CapsuleShape2D_6fc8e"]
radius = 21.0
height = 134.0

[sub_resource type="AtlasTexture" id="AtlasTexture_30f5m"]
atlas = ExtResource("1_tu7p3")
region = Rect2(384, 256, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_ux665"]
atlas = ExtResource("1_tu7p3")
region = Rect2(448, 256, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_yn75t"]
atlas = ExtResource("1_tu7p3")
region = Rect2(512, 256, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_g1iyo"]
atlas = ExtResource("1_tu7p3")
region = Rect2(0, 320, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_cih8q"]
atlas = ExtResource("1_tu7p3")
region = Rect2(64, 320, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_saveu"]
atlas = ExtResource("1_tu7p3")
region = Rect2(128, 320, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_crkbx"]
atlas = ExtResource("1_tu7p3")
region = Rect2(192, 320, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_gu3r3"]
atlas = ExtResource("1_tu7p3")
region = Rect2(256, 320, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_gim32"]
atlas = ExtResource("1_tu7p3")
region = Rect2(320, 320, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_ncxsw"]
atlas = ExtResource("1_tu7p3")
region = Rect2(320, 448, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_gbn47"]
atlas = ExtResource("1_tu7p3")
region = Rect2(384, 448, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_wskfs"]
atlas = ExtResource("1_tu7p3")
region = Rect2(448, 448, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_35gxv"]
atlas = ExtResource("1_tu7p3")
region = Rect2(512, 448, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_7s7lh"]
atlas = ExtResource("1_tu7p3")
region = Rect2(0, 512, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_heh76"]
atlas = ExtResource("1_tu7p3")
region = Rect2(64, 512, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_qkajn"]
atlas = ExtResource("1_tu7p3")
region = Rect2(128, 512, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_y338o"]
atlas = ExtResource("1_tu7p3")
region = Rect2(192, 512, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_8o3wn"]
atlas = ExtResource("1_tu7p3")
region = Rect2(256, 512, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_mtybm"]
atlas = ExtResource("1_tu7p3")
region = Rect2(320, 512, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_m8jkw"]
atlas = ExtResource("1_tu7p3")
region = Rect2(384, 512, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_w0ruy"]
atlas = ExtResource("1_tu7p3")
region = Rect2(448, 512, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_asxeb"]
atlas = ExtResource("1_tu7p3")
region = Rect2(512, 512, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_hpb2g"]
atlas = ExtResource("1_tu7p3")
region = Rect2(0, 576, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_ge354"]
atlas = ExtResource("1_tu7p3")
region = Rect2(64, 576, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_ae8wp"]
atlas = ExtResource("1_tu7p3")
region = Rect2(0, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_ja5c8"]
atlas = ExtResource("1_tu7p3")
region = Rect2(128, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_nrg15"]
atlas = ExtResource("1_tu7p3")
region = Rect2(192, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_i4ac5"]
atlas = ExtResource("1_tu7p3")
region = Rect2(384, 320, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_6nxfj"]
atlas = ExtResource("1_tu7p3")
region = Rect2(448, 320, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_tovrv"]
atlas = ExtResource("1_tu7p3")
region = Rect2(512, 320, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_ffhsa"]
atlas = ExtResource("1_tu7p3")
region = Rect2(0, 384, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_yjwfd"]
atlas = ExtResource("1_tu7p3")
region = Rect2(64, 384, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_evirn"]
atlas = ExtResource("1_tu7p3")
region = Rect2(128, 384, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_u688e"]
atlas = ExtResource("1_tu7p3")
region = Rect2(192, 384, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_hwtos"]
atlas = ExtResource("1_tu7p3")
region = Rect2(256, 384, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_6tgys"]
atlas = ExtResource("1_tu7p3")
region = Rect2(320, 384, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_gnt2t"]
atlas = ExtResource("1_tu7p3")
region = Rect2(384, 384, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_2rakm"]
atlas = ExtResource("1_tu7p3")
region = Rect2(448, 384, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_cfayb"]
atlas = ExtResource("1_tu7p3")
region = Rect2(512, 384, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_tldco"]
atlas = ExtResource("1_tu7p3")
region = Rect2(0, 448, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_slkpe"]
atlas = ExtResource("1_tu7p3")
region = Rect2(64, 448, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_dqhk7"]
atlas = ExtResource("1_tu7p3")
region = Rect2(128, 448, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_ya2ee"]
atlas = ExtResource("1_tu7p3")
region = Rect2(192, 448, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_klojs"]
atlas = ExtResource("1_tu7p3")
region = Rect2(256, 448, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_v4mmu"]
atlas = ExtResource("1_tu7p3")
region = Rect2(320, 448, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_tayt7"]
atlas = ExtResource("1_tu7p3")
region = Rect2(256, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_cwkxu"]
atlas = ExtResource("1_tu7p3")
region = Rect2(320, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_qd5fp"]
atlas = ExtResource("1_tu7p3")
region = Rect2(384, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_i04mt"]
atlas = ExtResource("1_tu7p3")
region = Rect2(448, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_4v4ub"]
atlas = ExtResource("1_tu7p3")
region = Rect2(512, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_kdj43"]
atlas = ExtResource("1_tu7p3")
region = Rect2(0, 64, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_ddygq"]
atlas = ExtResource("1_tu7p3")
region = Rect2(64, 64, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_38qy1"]
atlas = ExtResource("1_tu7p3")
region = Rect2(128, 64, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_bh34m"]
atlas = ExtResource("1_tu7p3")
region = Rect2(192, 64, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_iyly3"]
atlas = ExtResource("1_tu7p3")
region = Rect2(256, 64, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_5tage"]
atlas = ExtResource("1_tu7p3")
region = Rect2(320, 64, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_lrtit"]
atlas = ExtResource("1_tu7p3")
region = Rect2(448, 192, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_d12uj"]
atlas = ExtResource("1_tu7p3")
region = Rect2(512, 192, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_aqne6"]
atlas = ExtResource("1_tu7p3")
region = Rect2(0, 256, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_jakjo"]
atlas = ExtResource("1_tu7p3")
region = Rect2(64, 256, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_41l7i"]
atlas = ExtResource("1_tu7p3")
region = Rect2(128, 256, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_5mbif"]
atlas = ExtResource("1_tu7p3")
region = Rect2(192, 256, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_02rwg"]
atlas = ExtResource("1_tu7p3")
region = Rect2(256, 256, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_kplei"]
atlas = ExtResource("1_tu7p3")
region = Rect2(320, 256, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_38lxp"]
atlas = ExtResource("1_tu7p3")
region = Rect2(384, 64, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_4tryw"]
atlas = ExtResource("1_tu7p3")
region = Rect2(448, 64, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_kw4tn"]
atlas = ExtResource("1_tu7p3")
region = Rect2(512, 64, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_ecxtg"]
atlas = ExtResource("1_tu7p3")
region = Rect2(0, 128, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_fbd7o"]
atlas = ExtResource("1_tu7p3")
region = Rect2(64, 128, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_wmt25"]
atlas = ExtResource("1_tu7p3")
region = Rect2(128, 128, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_qj5vq"]
atlas = ExtResource("1_tu7p3")
region = Rect2(192, 128, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_ugco8"]
atlas = ExtResource("1_tu7p3")
region = Rect2(256, 128, 64, 64)

[sub_resource type="SpriteFrames" id="SpriteFrames_x6s1d"]
animations = [{
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_30f5m")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_ux665")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_yn75t")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_g1iyo")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_cih8q")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_saveu")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_crkbx")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_gu3r3")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_gim32")
}],
"loop": true,
"name": &"crouch",
"speed": 12.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_ncxsw")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_gbn47")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_wskfs")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_35gxv")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_7s7lh")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_heh76")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_qkajn")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_y338o")
}],
"loop": true,
"name": &"damage",
"speed": 12.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_8o3wn")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_mtybm")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_m8jkw")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_w0ruy")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_asxeb")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_hpb2g")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_ge354")
}],
"loop": true,
"name": &"dead",
"speed": 12.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_ae8wp")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_ja5c8")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_nrg15")
}],
"loop": true,
"name": &"idle",
"speed": 2.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_i4ac5")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_6nxfj")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_tovrv")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_ffhsa")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_yjwfd")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_evirn")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_u688e")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_hwtos")
}],
"loop": true,
"name": &"jump",
"speed": 12.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_6tgys")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_gnt2t")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_2rakm")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_cfayb")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_tldco")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_slkpe")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_dqhk7")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_ya2ee")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_klojs")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_v4mmu")
}],
"loop": true,
"name": &"jump_large",
"speed": 12.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_tayt7")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_cwkxu")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_qd5fp")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_i04mt")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_4v4ub")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_kdj43")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_ddygq")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_38qy1")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_bh34m")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_iyly3")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_5tage")
}],
"loop": true,
"name": &"punch",
"speed": 8.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_lrtit")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_d12uj")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_aqne6")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_jakjo")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_41l7i")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_5mbif")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_02rwg")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_kplei")
}],
"loop": true,
"name": &"run",
"speed": 12.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_38lxp")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_4tryw")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_kw4tn")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_ecxtg")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_fbd7o")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_wmt25")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_qj5vq")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_ugco8")
}],
"loop": true,
"name": &"walk",
"speed": 12.0
}]

[node name="CharacterBody2D" type="CharacterBody2D"]
script = SubResource("GDScript_2bxub")

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
position = Vector2(531, 336)
shape = SubResource("CapsuleShape2D_6fc8e")
debug_color = Color(0.77347, 0.419392, 0.385667, 0.42)

[node name="AnimatedSprite2D" type="AnimatedSprite2D" parent="."]
texture_filter = 1
position = Vector2(534, 303)
scale = Vector2(2.61328, 2.88281)
sprite_frames = SubResource("SpriteFrames_x6s1d")
animation = &"punch"
frame_progress = 0.824861
